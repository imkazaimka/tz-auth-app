# Raw Socket Authentication Server

Этот проект реализует backend-приложение для аутентификации и авторизации **без использования веб-фреймворков**.  
HTTP-запросы обрабатываются вручную через TCP-сокеты.  
Система включает регистрацию, вход, токены, управление профилем, смену пароля, сброс пароля и механизм RBAC (роли + разрешения).

Проект выполнен в полном соответствии с тестовым заданием, включая часть:

> "Вы должны продумать и в текстовом файле или в README.md описать схему вашей структуры управления ограничениями доступа."

---

# 1. Основные возможности

## 1.1 Пользовательские функции
- Регистрация
- Вход в систему
- Выход
- Получение информации о текущем пользователе (`/me`)
- Обновление профиля
- Смена пароля
- Сброс пароля
- Деактивация аккаунта (soft delete)

## 1.2 Токены
- **access_token** — живёт 15 минут
- **refresh_token** — живёт 30 дней
- Обновление пары токенов через `/token/refresh`

## 1.3 Разграничение прав (RBAC)
Реализованы:
- роли
- разрешения (permissions)
- связи ролей и прав
- назначение ролей пользователям
- проверка прав при доступе к защищённым ресурсам

Пример защищённого эндпоинта:  
`GET /admin/users` требует permission: **admin.view_users**

---

# 2. Архитектура RBAC  
### (Выполнение требования ТЗ: "описать схему структуры управления ограничениями доступа")

## 2.1 Основные сущности

| Таблица | Назначение |
|---------|------------|
| **users** | учётные записи пользователей |
| **roles** | список ролей |
| **permissions** | атомарные действия |
| **user_roles** | привязка пользователей к ролям |
| **role_permissions** | привязка ролей к permissions |
| **access_tokens** | короткоживущие токены доступа |
| **refresh_tokens** | токены обновления |

## 2.2 Алгоритм принятия решения при доступе
1. Клиент отправляет запрос с заголовком:  
   `Authorization: Bearer <access_token>`
2. Сервер проверяет:
   - существует ли токен в БД
   - не истёк ли срок действия
   - активен ли пользователь
   - не заблокирован ли он
3. Загружаются роли пользователя.
4. Загружаются permissions, связанные с ролями.
5. Если требуемое разрешение отсутствует → `403 Forbidden`.
6. Иначе — доступ разрешён.



## 3.1 Компонентная диаграмма системы

Отражает структуру модулей backend-сервера и их взаимодействие.

![Component Diagram](./diagrams/component-server.png)

---

## 3.2 Диаграмма последовательности: LOGIN

Показывает, как обрабатывается запрос `/login`:  
валидация пользователя → генерация токенов → сохранение токенов → ответ клиенту.

![Login Sequence Diagram](./diagrams/sequence-login.png)

---

## 3.3 Диаграмма последовательности: Permission Check (RBAC)

На примере запроса `/admin/users`.  
Диаграмма показывает проверку токена и наличия разрешения `admin.view_users`.

![Permission Check Diagram](./diagrams/sequence-permission.png)

---

# 4. Соответствие ТЗ

| Требование | Реализация |
|------------|------------|
| Регистрация | ✓ |
| Вход / выход | ✓ |
| Хранение паролей в хеше | ✓ (PBKDF2-HMAC SHA-256) |
| Работа с access / refresh токенами | ✓ |
| Редактирование профиля | ✓ |
| Смена пароля | ✓ |
| Сброс пароля | ✓ |
| Ограничение доступа через права | ✓ (RBAC) |
| Описание схемы доступа в README | ✓ (полностью выполнено) |
| HTTP-сервер без фреймворков | ✓ |

---

# 5. Запуск сервера

python3 server.py
